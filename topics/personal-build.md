[//]: # (title: Running Personal Build)
[//]: # (auxiliary-id: Running Personal Build;Personal Build)
[//]: # (help-id: Personal Build)

<snippet id="personal-build-overview">

A _personal build_ is a build out of the common build sequence which typically uses the changes not yet committed into the version control. Personal builds are usually initiated from one of the [supported IDEs](supported-platforms-and-environments.md#Remote+Run+and+Pre-tested+Commit) via the [Remote Run](remote-run.md) procedure.

You can also start a personal build from the [Run Custom Build dialog](running-custom-build.md) and upload a patch with changes directly to the server.

<img src="dk-personal-build-upload-patch.png" width="706" alt="Upload patch in TeamCity UI"/>

Personal builds are marked with a corresponding icon and are visible only to users who initiated them. To view personal builds of other TeamCity users, enable the **Show all personal builds** option under __[User Profile](configuring-your-user-profile.md) | General | UI settings__ .

<img src="dk-personal-build-icon.png" width="706" alt="Personal builds icon"/>

</snippet>

A personal build uses the current VCS repository sources plus the changed files identified during the remote run initiation. The results of a personal build can be seen in the "My Changes" view of the corresponding IDE plugin and on the __[Changes](viewing-user-changes-in-builds.md)__ page in TeamCity. Finished personal builds are listed in the [build history](build-results-page.md#Build+History+in+Classic+UI), but only for the users who initiated them. Read more about running commits via Remote Run in [Pre-Tested (Delayed) Commit](pre-tested-delayed-commit.md).

By default, only users with the Project Developer [role](managing-roles-and-permissions.md) can initiate a personal build.

It is possible to [restrict running personal builds](configuring-general-settings.md#Allow+Triggering+Personal+Builds) in the __General Settings__ of a build configuration.

## Direct Patch Upload

Users with the _Change build source code with a custom patch_ permission can upload a patch with local changes directly to the TeamCity server, via our web UI or REST API.

TeamCity supports patches in a [unified diff format](https://en.wikipedia.org/wiki/Diff#Unified_format).  
Since the format varies between tools that can generate unidiff files, we cannot guarantee error-free processing of all unidiff variations. Currently, TeamCity provides a stable parsing of unidiff files generated by IntelliJ Platform IDEs and Git.  
TeamCity does not support binary changes in non-binary files.


To generate a patch:
* __In any IntelliJ Platform IDE__: select the required local changes in the commit log, click [Create Patch](https://www.jetbrains.com/help/idea/use-patches.html#create-patch) in the context menu, and save the patch as a `*.diff` file.
* __Via Git__: run `git diff commit1..commit2 > path/filename.diff`.   
For example, to save a diff between the last commit and the preceding commit to the `patch.diff` file in the `test` directory, run `git diff HEAD^ HEAD > ~/test/patch.diff`. See other examples in [Git documentation](https://git-scm.com/docs/git-diff#_examples).

To upload a patch and run a personal build via the web UI:
1. Open the [Run Custom Build](running-custom-build.md) dialog and enable the "_run as a personal build_" option. The __Upload patch__ button will appear. <img src="upload-patch-ui.png" alt="Upload a unidiff patch via UI" width="500"/>
2. Upload the patch and click __Run Build__.   
The agent will receive the patch and apply it before running the build. After the build, it will revert the patch, so the checkout directory can be reused by subsequent builds.

To upload a patch and run a personal build via REST API:

1. Send the following `POST` request:
    ```Shell
    curl \
       -X POST \
       -H "Content-Type: text/text" \
       -H "Origin: <host>:<port>" \
       --data-binary @patch.diff \
       "http://<username>:<password>@<host>:<port>/uploadDiffChanges.html?description=<description-text>&commitType=0"
   ```
   As a response, you will receive the ID of this change on the server.   
2. Create an XML file that describes the build node and mentions the build configuration ID and the ID of your personal change:
   ```xml
   <build personal="true">
     <triggered type='idePlugin' details='Unified Diff Patch'/>
     <triggeringOptions cleanSources="false" rebuildAllDependencies="false" queueAtTop="false"/>
     <buildType id="<build_configuration_id>"/>
     <lastChanges>
       <change id="<change_ID>" personal="true"/>
     </lastChanges>
   </build>
   ```   
3. To trigger a personal build via REST API, post the created file to the `buildQueue` endpoint:
   ```Shell
    curl \
        -X POST \
        -H "Content-Type: application/xml" \
        -H "Origin: <host>:<port>" \
        --data @node.xml \
        "http://<username>:<password>@<host>:<port>/app/rest/buildQueue"
   ```   
   The agent will receive the patch and apply it before running the build. After the build, it will revert the patch, so the checkout directory can be reused by subsequent builds. Unused patches are automatically cleaned up by a 15-minutes timeout.

## Promoting Personal Build

You can promote a personal build in the [same way as a non-personal build](running-custom-build.md#Promoting+Build). After promotion, the dependent build will be run as a personal one and use the same patch.

## Triggering Personal Build Chain

When a personal build chain is triggered, TeamCity will make all builds of the build chain personal and try to apply the personal patch to all of them. 
However, TeamÐ¡ity will not apply the patch if the changes do not match checkout rules. 
For example, if a patch changes `src/File.java` but the _VCS Checkout Rules_ configuration excludes the `src` folder, then the patch will not be applied, and the source code on the agent will not be changed. 
In this case, this build can be optimized to a non-personal build that checks out the same revision.

## Run Build on Perforce Shelved Files

If the current build configuration has a [Perforce VCS root](perforce.md), you can run a personal build based on changes in [shelved Perforce files](https://www.perforce.com/manuals/v17.1/p4guide/Content/CmdRef/p4_shelve.html). For this, enable the _run as a personal build_ option and enter the target changelist ID in the _Shelved changelist ID_ field.

>Learn how to [automate such builds](perforce-shelve-trigger.md).

 <seealso>
        <category ref="installation">
            <a href="intellij-platform-plugin.md">IntelliJ Platform Plugin</a>
            <a href="visual-studio-addin.md">Visual Studio Add-in</a>
        </category>
        <category ref="concepts">
            <a href="pre-tested-delayed-commit.md">Pre-tested Commit</a>
            <a href="remote-run.md">Remote Run</a>
        </category>
        <category ref="troubleshooting">
            <a href="reporting-issues.md">Remote Run Problems</a>
        </category>
        <category ref="external">
            <a href="https://youtu.be/icuhBgEFtVM">Video tutorial: TeamCity for developers</a>
        </category>
</seealso>